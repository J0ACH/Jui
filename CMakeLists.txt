PROJECT (Jui)
CMAKE_MINIMUM_REQUIRED( VERSION 3.7.2 )

# GLOBAL SETUP ###################################################

SET(CMAKE_INSTALL_PREFIX ${CMAKE_SOURCE_DIR}/build)
SET(CMAKE_ARCHIVE_OUTPUT_DIRECTORY ${CMAKE_SOURCE_DIR}/build/lib)
SET(CMAKE_LIBRARY_OUTPUT_DIRECTORY ${CMAKE_SOURCE_DIR}/build/lib)
SET(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_SOURCE_DIR}/build/bin)
SET(CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS TRUE)

# FUNCTIONS SETUP ###################################################

FUNCTION(QT_ADDMODULE TARGET MODULE)
	
	MESSAGE(STATUS "MODULE: " ${MODULE})
	FIND_PACKAGE(Qt5 REQUIRED COMPONENTS ${MODULE})
	
	GET_TARGET_PROPERTY(module_INCLUDE_DIRS Qt5::${MODULE} INTERFACE_INCLUDE_DIRECTORIES)
	GET_TARGET_PROPERTY(module_LIBRARIES Qt5::${MODULE} IMPORTED_IMPLIB_RELEASE)
	GET_TARGET_PROPERTY(module_LOCATION Qt5::${MODULE} IMPORTED_LOCATION_RELEASE)
		
	TARGET_INCLUDE_DIRECTORIES(${TARGET} PUBLIC ${module_INCLUDE_DIRS})
	TARGET_LINK_LIBRARIES(${TARGET} PUBLIC ${module_LIBRARIES})
	
	INSTALL(FILES ${module_LOCATION} DESTINATION install)
	
	MESSAGE(STATUS "Qt5${MODULE}_LIBRARIES: " ${module_LIBRARIES})
	MESSAGE(STATUS "Qt5${MODULE}_LOCATION: " ${module_LOCATION})
	MESSAGE(STATUS "Qt5${MODULE}_INCLUDE_DIRS: ")
	FOREACH(onePath ${module_INCLUDE_DIRS})
	 	MESSAGE(STATUS "\t - " ${onePath})
	ENDFOREACH(onePath)

ENDFUNCTION(QT_ADDMODULE)

# LIBRARY SETUP ###################################################

ADD_LIBRARY(Jui SHARED "")
QT_ADDMODULE(Jui Core)
QT_ADDMODULE(Jui Widgets)
QT_ADDMODULE(Jui Gui)

# CONFIG SETUP ###################################################

ADD_EXECUTABLE(Config "")
TARGET_INCLUDE_DIRECTORIES(Config PUBLIC ${CMAKE_SOURCE_DIR}/build/include)
TARGET_INCLUDE_DIRECTORIES(Config PUBLIC ${CMAKE_SOURCE_DIR}/src/Core)
TARGET_LINK_LIBRARIES(Config PUBLIC Jui)

ADD_SUBDIRECTORY(src)


INSTALL(
	TARGETS Jui Config
	EXPORT JuiTargets
    RUNTIME DESTINATION install
	CONFIGURATIONS Release
)

# PACKAGE SETUP ###################################################

INCLUDE(CMakePackageConfigHelpers)

CONFIGURE_PACKAGE_CONFIG_FILE(
	${CMAKE_SOURCE_DIR}/JuiConfig.cmake.in
	${CMAKE_BINARY_DIR}/JuiConfig.cmake
	INSTALL_DESTINATION lib/cmake
	#PATH_VARS ${CMAKE_BINARY_DIR@/bin}
)

EXPORT(EXPORT JuiTargets FILE ${CMAKE_BINARY_DIR}/JuiTargets.cmake)
EXPORT ( PACKAGE Jui ) 


