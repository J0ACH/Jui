
#INCLUDE(RegPackageMacro)

find_package(Qt5 COMPONENTS Core Widgets Gui REQUIRED)
add_subdirectory(Core)
add_subdirectory(Configuration)

# JUI SETUP ###################################################

add_library(Jui SHARED
	${Core_hdr}
	${Core_src}
	${Core_res}
)
target_include_directories(Jui 
	PRIVATE
		${CMAKE_CURRENT_LIST_DIR}/Core
	INTERFACE 
		$<INSTALL_INTERFACE:include>
)
target_link_libraries(Jui 
	PRIVATE 
		Qt5::Core
		Qt5::Gui
		Qt5::Widgets
)

# JUI INSTALL ###################################################

install( 
	TARGETS Jui 
	EXPORT JuiTargets
	ARCHIVE DESTINATION lib
    LIBRARY DESTINATION lib
	RUNTIME DESTINATION bin
)
install(
	FILES 
		$<TARGET_FILE:Qt5::Core> 
		$<TARGET_FILE:Qt5::Gui>
		$<TARGET_FILE:Qt5::Widgets>
	DESTINATION bin
)

#[[
install(
	FILES ${Core_hdr}
	DESTINATION include
)
#]]


#RegPackage(Jui)

# CONFIG SETUP ###################################################

add_executable(Config
	${Config_hdr}
	${Config_src}
)

target_include_directories(Config 
	PRIVATE 
		${CMAKE_CURRENT_LIST_DIR}/Configuration
		${CMAKE_CURRENT_LIST_DIR}/Core
)
target_link_libraries(Config 
	PRIVATE 
		Jui
		Qt5::Core
		Qt5::Widgets
		Qt5::WinMain # dulezity pro main() funkci
)

if(WIN32)
	if( ${CMAKE_CONFIGURATION_TYPES} STREQUAL "Release" )
		set_target_properties(Config PROPERTIES WIN32_EXECUTABLE TRUE)
	endif()
endif(WIN32)

# CONFIG INSTALL ###################################################

install(
	TARGETS Config
	EXPORT JuiTargets
	RUNTIME DESTINATION bin
)

# JUI PACKAGE ###################################################

set(INCLUDE_INSTALL_DIR include/)
set(LIB_INSTALL_DIR lib/)
set(SYSCONFIG_INSTALL_DIR etc/foo/)

include(CMakePackageConfigHelpers)
configure_package_config_file(
	JuiConfig.cmake.in
	${CMAKE_CURRENT_BINARY_DIR}/JuiConfig.cmake
	INSTALL_DESTINATION lib/cmake
	PATH_VARS INCLUDE_INSTALL_DIR SYSCONFIG_INSTALL_DIR
)
write_basic_package_version_file(
	${CMAKE_CURRENT_BINARY_DIR}/JuiConfigVersion.cmake
	VERSION ${PROJECT_VERSION}
	COMPATIBILITY AnyNewerVersion 
)
export(
	TARGETS Jui Config		
	FILE ${CMAKE_CURRENT_BINARY_DIR}/JuiTargets2.cmake
)

install(
	FILES 
		${CMAKE_CURRENT_BINARY_DIR}/JuiConfig.cmake
		${CMAKE_CURRENT_BINARY_DIR}/JuiConfigVersion.cmake
		${CMAKE_CURRENT_BINARY_DIR}/JuiTargets2.cmake
	DESTINATION
		lib/cmake 
)
#[[
#]]
install(
	EXPORT JuiTargets
	DESTINATION lib/cmake
	#FILE JuiTargets.cmake
	#CONFIGURATIONS Release
)
install(CODE "MESSAGE(\"Sample install message.\")")